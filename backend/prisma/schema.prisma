// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  login             String    @unique
  email             String    @unique
  first_name        String
  last_name         String
  nickname          String    @unique
  avatar            String?

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  is_active         Boolean   @default(true)

  friends         User[] @relation("friends")
  friendsRelation User[] @relation("friends")
  // hash      //autenticação de multiplos fatores. Autenticação google

  match_as_player_1 Match[]   @relation(name: "player_1")
  match_as_player_2 Match[]   @relation(name: "player_2")

  match_wins        Match[]   @relation(name: "winner")
  math_loses        Match[]   @relation(name: "loser")

  points            Int       @default(0)

  @@map("user")
}

model Match {
  id String @id @default(uuid())

  player1_id String
  player_1   User?  @relation(name: "player_1", fields: [player1_id], references: [id])
  score_p1   Int    @default(0)

  player2_id String
  player_2   User?  @relation(name: "player_2", fields: [player2_id], references: [id])
  score_p2   Int    @default(0)

  winner_id String?
  winner    User?   @relation(name: "winner", fields: [winner_id], references: [id])

  loser_id String?
  loser    User?   @relation(name: "loser", fields: [loser_id], references: [id])

  draws   Boolean? @default(false)

  @@map("match")
}

model DirectMessage {
  id              String    @id @default(uuid())
  users           User[]    @relation(name: "user_chatroom")
  message         Message[]  @relation(name: "chat_mesage")

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@map("direct_message")
}


model ChatRoom {
  id              String    @id @default(uuid())
  name            String

  type            String    @default("public")
  password        String?

  owner_id        String
  owner           User?     @relation(name: "owner", fields: [owner_id], references: [id])
  admin           User[]    @relation(name: "admin")
  users           User[]    @relation(name: "user_chatroom")
  message          Message[]  @relation(name: "chat_mesage")

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@map("chat_room")
}

model Message {
  id              String    @id  @default(uuid())

  content         String
  img_url         String?
  user_id         String
  user            User?      @relation(name: "user_mesage", fields: [user_id], references: [id], onDelete: Cascade)
  chat_room_id    String
  chat_room       ChatRoom?  @relation(name: "chat_mesage", fields: [chat_room_id], references: [id], onDelete: Cascade)

  createdAt         DateTime    @default(now())

  @@map("message")
}
